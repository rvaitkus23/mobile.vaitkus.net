var gaPlugin=null,initGA=function(){gaPlugin=window.plugins.gaPlugin,gaPlugin.init(successGAHandler,errorGAHandler,"UA-50314640-1",10),gaPlugin.trackEvent(successGAHandler,errorGAHandler,"App","Open","open",1)},successGAHandler=function(result){console.log("GA Success: "+result)},errorGAHandler=function(error){console.log("GA error: "+error)},openFB=function(){function init(appId,redirectURL,store){fbAppId=appId,redirectURL&&(oauthRedirectURL=redirectURL),store&&(tokenStore=store)}function login(scope,success,error){if(!fbAppId)return error({error:"Facebook App Id not set."});var loginWindow;if(scope=scope||"",loginSuccessHandler=success,loginErrorHandler=error,loginProcessed=!1,logout(),!oauthRedirectURL)if(runningInCordova)oauthRedirectURL="https://www.facebook.com/connect/login_success.html";else{var index=document.location.href.indexOf("#");if(!(index>0))return alert("Can't reliably infer the OAuth redirect URI. Please specify it explicitly in openFB.init()");oauthRedirectURL=window.document.location.href.substring(0,index)+"oauthcallback.html"}loginWindow=window.open(FB_LOGIN_URL+"?client_id="+fbAppId+"&redirect_uri="+oauthRedirectURL+"&response_type=token&display=popup&scope="+scope,"_blank","location=no"),runningInCordova&&(loginWindow.addEventListener("loadstart",function(event){var url=event.url;(url.indexOf("access_token=")>0||url.indexOf("error=")>0)&&(loginWindow.close(),oauthCallback(url))}),loginWindow.addEventListener("exit",function(){loginProcessed||loginErrorHandler({error:"user_cancelled",error_description:"User cancelled login process",error_reason:"user_cancelled"})}))}function oauthCallback(url){var queryString,obj;loginProcessed=!0,url.indexOf("access_token=")>0?(queryString=url.substr(url.indexOf("#")+1),obj=parseQueryString(queryString),tokenStore.fbtoken=obj.access_token,loginSuccessHandler&&loginSuccessHandler()):url.indexOf("error=")>0?(queryString=url.substring(url.indexOf("?")+1,url.indexOf("#")),obj=parseQueryString(queryString),loginErrorHandler&&loginErrorHandler(obj)):loginErrorHandler&&loginErrorHandler()}function logout(){tokenStore.fbtoken=void 0}function api(obj){var url,method=obj.method||"GET",params=obj.params||{},xhr=new XMLHttpRequest;params.access_token=tokenStore.fbtoken,url="https://graph.facebook.com"+obj.path+"?"+toQueryString(params),xhr.onreadystatechange=function(){if(4===xhr.readyState)if(200===xhr.status)obj.success&&obj.success(JSON.parse(xhr.responseText));else{var error=xhr.responseText?JSON.parse(xhr.responseText).error:{message:"An error has occurred"};obj.error&&obj.error(error)}},xhr.open(method,url,!0),xhr.send()}function revokePermissions(success,error){return api({method:"DELETE",path:"/me/permissions",success:function(){tokenStore.fbtoken=void 0,success()},error:error})}function parseQueryString(queryString){var qs=decodeURIComponent(queryString),obj={},params=qs.split("&");return params.forEach(function(param){var splitter=param.split("=");obj[splitter[0]]=splitter[1]}),obj}function toQueryString(obj){var parts=[];for(var i in obj)obj.hasOwnProperty(i)&&parts.push(encodeURIComponent(i)+"="+encodeURIComponent(obj[i]));return parts.join("&")}var fbAppId,oauthRedirectURL,loginSuccessHandler,loginErrorHandler,runningInCordova,loginProcessed,FB_LOGIN_URL="https://www.facebook.com/dialog/oauth",tokenStore=window.sessionStorage;return document.addEventListener("deviceready",function(){runningInCordova=!0},!1),{init:init,login:login,logout:logout,revokePermissions:revokePermissions,api:api,oauthCallback:oauthCallback}}();document.addEventListener("deviceready",function(){initGA()},!1),angular.module("vaitkus",["ionic","vaitkus.controllers","vaitkus.directives"]).run(function($ionicPlatform){$ionicPlatform.ready(function(){window.StatusBar&&StatusBar.styleDefault()})}).config(function($stateProvider,$urlRouterProvider){$stateProvider.state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html",controller:"AppCtrl"}).state("app.startpage",{url:"/startpage",views:{menuContent:{templateUrl:"templates/startPage.html",controller:"startPageCtrl"}}}).state("app.about",{url:"/about",views:{menuContent:{templateUrl:"templates/about.html",controller:"aboutCtrl"}}}).state("app.features",{url:"/features",views:{menuContent:{templateUrl:"templates/features.html",controller:"featuresCtrl"}}}).state("app.contacts",{url:"/contacts",views:{menuContent:{templateUrl:"templates/contacts.html"}}}).state("app.camera",{url:"/camera",views:{menuContent:{templateUrl:"templates/camera.html",controller:"cameraCtrl"}}}).state("app.map",{url:"/map",views:{menuContent:{templateUrl:"templates/map.html",controller:"mapCtrl"}}}).state("app.pushNotification",{url:"/pushNotification",views:{menuContent:{templateUrl:"templates/pushNotification.html",controller:"pushNotificationCtrl"}}}).state("app.localNotification",{url:"/localNotification",views:{menuContent:{templateUrl:"templates/localNotification.html",controller:"localNotificationCtrl"}}}).state("app.OAuth",{url:"/OAuth",views:{menuContent:{templateUrl:"templates/OAuth.html",controller:"OAuthCtrl"}}}).state("app.barcodeScanner",{url:"/barcodeScanner",views:{menuContent:{templateUrl:"templates/barcodeScanner.html",controller:"barcodeScannerCtrl"}}}).state("app.flashlight",{url:"/flashlight",views:{menuContent:{templateUrl:"templates/flashlight.html",controller:"flashlightCtrl"}}}),$urlRouterProvider.otherwise("/app/startpage")}).run(["$rootScope",function($rootScope){$rootScope.$on("$stateChangeStart",function(event,currRoute){console.log("--route changed "+currRoute.name),null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"PageChange",currRoute.name,"",1)})}]),angular.module("vaitkus.controllers",[]).controller("AppCtrl",function($scope,$location,$rootScope){$scope.navigate=function(path){$location.path("/app/"+path)},$rootScope.$on("$routeChangeStart",function(event,currRoute,prevRoute){console.log("--route changed "+currRoute),null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"PageChange",currRoute,prevRoute,1)})}),angular.module("vaitkus.controllers").controller("startPageCtrl",function($scope,$location){$scope.navigate=function(path){$location.path("/app/"+path)}}),angular.module("vaitkus.controllers").controller("aboutCtrl",function($scope,$location){$scope.navigate=function(path){$location.path("/app/"+path)}}),angular.module("vaitkus.controllers").controller("barcodeScannerCtrl",function($scope,$location){$scope.result="Result will be placed here",$scope.title="Scan",$scope.scan=function(){null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"Feature","Scan","start",1),cordova.plugins.barcodeScanner.scan(function(result){$scope.$apply(function(){$scope.result=result.text}),null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"Feature","Scan","success",1)},function(error){null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"Feature","Scan","failed: "+error,1),alert("Scanning failed: "+error)})},$scope.navigate=function(path){$location.path("/app/"+path)}}),angular.module("vaitkus.controllers").controller("cameraCtrl",function($scope,$location){$scope.takePicture=function(){navigator.camera.getPicture($scope.onSuccess,$scope.onFail,{quality:50,destinationType:Camera.DestinationType.FILE_URI}),null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"Feature","Camera","take picture",1)},$scope.onSuccess=function(imageURI){$scope.$apply(function(){$scope.imageSrc=imageURI}),null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"Feature","Camera","success",1)},$scope.onFail=function(message){alert("Failed because: "+message),null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"Feature","Camera","failed: "+message,1)},$scope.navigate=function(path){$location.path("/app/"+path)}}),angular.module("vaitkus.controllers").controller("featuresCtrl",function($scope,$location){$scope.device="undefined"!=typeof device?device:{model:"Web browser",platform:"Desktop"},$scope.cards=[{title:"Camera",body:"Take a picture using standard device camera and use it in app. You can pick picture from you gallery as well. In sample it only adds image into page, but on demand it can be deal in any other way.",link:"camera"},{title:"Map GPS",body:"Load map and locate you self on the map. Having location coordinates you can send it to server and it can find nearest objects like events, shops, friends, anything you want to.",link:"map"},{title:"Push notification",body:"Todays smartphone apps without notifications is very rear. Most apps does have this feature. Let's take a look how this stuff is implemented in here.",link:"pushNotification"},{title:"Local notification",body:"Push notification has to be invoked from server side. But we can set timer and invoke notification localy and no back-end server is needed.",link:"localNotification"},{title:"OAuth",body:"User hate registring for each app they install, but we can use thier existing accounts like Facebook and use it for identifing your app users.",link:"OAuth"},{title:"Barcode Scanner",body:"Entering long stings in mobile app is a pain. Currently more and more this kind of entering long links or other strings is replace using QR codes and scanners. We can implement it in apps as well.",link:"barcodeScanner"},{title:"Flashlight",body:"Some fun stuff like turning on device flashlight to use it like ",link:"flashlight"}],$scope.navigate=function(path){$location.path("/app/"+path)}}),angular.module("vaitkus.controllers").controller("flashlightCtrl",function($scope,$location){function flashlightSuccess(message){null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"Feature","FlashLight","success: "+message,1)}function flashlightError(message){alert("error: "+message),null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"Feature","FlashLight","error: "+message,1)}$scope.title="Turn On",window.plugins.flashlight.available(function(isAvailable){isAvailable||alert("Flashlight not available on this device")}),$scope.switchLight=function(){null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"Feature","FlashLight",$scope.isTurnedOn,1),$scope.isTurnedOn?(window.plugins.flashlight.switchOff(flashlightSuccess,flashlightError),$scope.isTurnedOn=!1,$scope.title="Turn On"):(window.plugins.flashlight.switchOn(flashlightSuccess,flashlightError),$scope.isTurnedOn=!0,$scope.title="Turn Off")},$scope.navigate=function(path){$location.path("/app/"+path)}}),angular.module("vaitkus.controllers").controller("localNotificationCtrl",function($scope,$location){$scope.outputText="",$scope.buttonTitle="Set notification in 10s",$scope.setNotification=function(){window.plugin.notification.local.add({id:"1",date:new Date((new Date).getTime()+1e4),message:"Thank you for trying out this app. You are more than welcome to contact me",title:"This is local notification",badge:1,json:JSON.stringify({name:"passed",message:"you have received"}),autoCancel:!0}),$scope.buttonTitle="Notification is set",$scope.outputText="Notification has been scheduled in 10 seconds check you statusbar and you will find notification. Click it and come back you the app",null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"Feature","Local Notification","set",1)},window.plugin.notification.local.onclick=function(){$scope.$apply(function(){$scope.outputText="You have just received notification you clicked for. It works as expected and can be used in any way you need."}),null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"Feature","Local Notification","recieved",1)},$scope.navigate=function(path){$location.path("/app/"+path)}}),angular.module("vaitkus.controllers").controller("mapCtrl",function($scope,$location){function initMap(latitude,longitude){var myLocation=new google.maps.LatLng(latitude,longitude);map=new google.maps.Map(document.getElementById("map-canvas"),{mapTypeId:google.maps.MapTypeId.ROADMAP,center:myLocation,zoom:15});new google.maps.Marker({position:new google.maps.LatLng(latitude,longitude),map:map,title:"You are here!",animation:google.maps.Animation.DROP});null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"Feature","Map","init",1)}var map,locationSuccess=function(position){initMap(position.coords.latitude,position.coords.longitude)},locationError=function(error){alert(error.message),initMap(51.506744,-.117477)};navigator.geolocation.getCurrentPosition(locationSuccess,locationError),$scope.navigate=function(path){$location.path("/app/"+path)}}),angular.module("vaitkus.controllers").controller("OAuthCtrl",function($scope,$location){$scope.error="",$scope.name="You are unregistred",$scope.isLoggedIn=!1,$scope.showPicture=!1,$scope.pictureUrl="",$scope.output="",openFB.init("598625876899341");var formatFBOutput=function(data){var output="";output+="Hi "+data.name+". ",output+="You are "+data.gender,data.location&&(output+=" and you are living in wonderful town called "+data.location.name),output+=". ",data.hometown&&(output+="Your hometown is "+data.hometown.name+". "),data.education&&(output+="You were attending "+data.education[data.education.length-1].school.name+". "),data.work&&(output+="And now you are working in "+data.work[0].employer.name+" ",data.work[0].position&&(output+="as "+data.work[0].position.name),output+=". "),output+="All the information you can see about your self can variate according to your security level in Facebook, what information can be seen to public users",$scope.output=output},getFBInfo=function(){openFB.api({path:"/me",success:function(data){console.log(data),$scope.$apply(function(){formatFBOutput(data)})},error:function(error){$scope.$apply(function(){$scope.error=error}),console.log(error)}}),openFB.api({path:"/me",params:{fields:"picture.type(small)"},success:function(data){data.picture&&data.picture.data&&data.picture.data.url&&$scope.$apply(function(){$scope.pictureUrl=data.picture.data.url,$scope.showPicture=!0}),console.log("picture"),console.log(data)},error:function(error){console.log(error)}})};$scope.fbLogin=function(){null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"Feature","FB login","start",1),$scope.isLoggedIn?getFBInfo():openFB.login("email",function(){$scope.isLoggedIn=!0,null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"Feature","FB login","success",1),getFBInfo()},function(error){$scope.isLoggedIn=!1,null!==gaPlugin&&gaPlugin.trackEvent(successGAHandler,errorGAHandler,"Feature","FB login","failed: "+error.error_description,1)})},$scope.navigate=function(path){$location.path("/app/"+path)}}),angular.module("vaitkus.controllers").controller("pushNotificationCtrl",function($scope,$location){$scope.navigate=function(path){$location.path("/app/"+path)}}),angular.module("vaitkus.directives",[]).directive("fullHeight",function(){return function(scope,element,attr){var parent=element.parent().parent(),parentHeight=parent.prop("offsetHeight");console.log(parentHeight);var elementHeight=parentHeight-attr.heightOffset;element.css("height",elementHeight+"px")}});